---
import { getCollection } from 'astro:content';
import Layout from '../layouts/Layout.astro';

const allSongs = (await getCollection('songs')).sort((a, b) => {
  const isMiscA = a.slug.toLowerCase().includes('miscellaneous') || a.slug.toLowerCase().includes('misc');
  const isMiscB = b.slug.toLowerCase().includes('miscellaneous') || b.slug.toLowerCase().includes('misc');
  if (isMiscA && !isMiscB) return -1;
  if (!isMiscA && isMiscB) return 1;
  return a.data.title.localeCompare(b.data.title);
});

// === LOGIC MỚI: LẤY ẢNH ĐẦU TIÊN ===
const firstSong = allSongs[0];
// Lấy ảnh cover, nếu không có thì lấy logo, không có nữa thì để rỗng
const initialCover = firstSong?.data.cover || firstSong?.data.logo || "";
---

<Layout title="Trang chủ | Rainei Lyrics List">
  
  <div class="pt-10 mb-12 text-center">
     <h1 class="text-4xl md:text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-purple-500 pb-2">
      Rainei Lyrics List
    </h1>
    <p class="text-slate-400 mt-2">Tổng hợp lời Việt hoá các bài hát do mình thực hiện.</p>
  </div>

  <div class="relative flex gap-10 items-start">
    
    <div class="hidden lg:block w-[260px] sticky top-10 shrink-0">
      <div class="aspect-[2/3] rounded-xl overflow-hidden shadow-2xl border border-slate-700 bg-slate-900 relative">
        
        <img 
          id="preview-img" 
          src={initialCover} 
          class={`w-full h-full object-cover transition-all duration-500 ${initialCover ? '' : 'opacity-0'}`}
          alt="Preview"
        />
        
        <div 
          id="preview-placeholder" 
          class={`absolute inset-0 flex items-center justify-center bg-slate-800 text-slate-600 transition-opacity duration-500 ${initialCover ? 'opacity-0' : ''}`}
        >
           <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
        </div>

      </div>
    </div>

    <div class="flex-1 w-full">
      <div class="px-5 py-3 text-xs font-bold text-slate-500 uppercase tracking-widest border-b border-slate-800">
        Title
      </div>

      <div class="flex flex-col">
        {allSongs.map((song) => (
          <a 
            href={`/songs/${song.slug}`}
            class="song-row group flex items-center px-5 py-4 border-b border-slate-800/50 hover:bg-slate-800/60 hover:pl-8 transition-all duration-300 cursor-pointer"
            data-cover={song.data.cover || song.data.logo || ""} 
          >
            <div class="font-medium text-slate-300 group-hover:text-white group-hover:scale-105 transition-transform origin-left text-lg">
              {song.data.title}
            </div>
          </a>
        ))}
      </div>
    </div>
  </div>

  <script>
    const previewImg = document.getElementById('preview-img');
    const placeholder = document.getElementById('preview-placeholder');
    const rows = document.querySelectorAll('.song-row');

    rows.forEach(row => {
      row.addEventListener('mouseenter', () => {
        const cover = row.getAttribute('data-cover');

        if (cover && cover !== "") {
            previewImg.src = cover;
            previewImg.classList.remove('opacity-0'); 
            placeholder.classList.add('opacity-0');   
        } else {
            previewImg.classList.add('opacity-0');    
            placeholder.classList.remove('opacity-0');
        }
      });
    });
  </script>

</Layout>