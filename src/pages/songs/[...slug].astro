---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const songs = await getCollection('songs');
  return songs.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content, headings } = await entry.render();
---

<Layout title={entry.data.title}>
  <div class="lg:grid lg:grid-cols-[1fr_300px] lg:gap-7 relative items-start">
    
    <main class="min-w-0">
      <a href="/" class="fixed bottom-8 right-8 z-50 flex items-center gap-2 px-6 py-3 bg-sky-600 text-white rounded-full shadow-[0_0_20px_rgba(14,165,233,0.5)] hover:bg-sky-500 hover:scale-105 transition-all duration-300 font-bold no-underline group">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="group-hover:-translate-x-1 transition-transform"><path d="m15 18-6-6 6-6"/></svg>
        <span>Danh sách</span>
      </a>
      
      <header class="mb-8 pb-4 border-b border-slate-800">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">{entry.data.title}</h1>
        {entry.data.artist && <p class="text-xl text-slate-400 italic">{entry.data.artist}</p>}
      </header>

      <article class="prose prose-invert prose-lg max-w-none prose-headings:text-sky-300 prose-a:text-sky-400 prose-blockquote:border-l-sky-500">
        <Content />
      </article>
    </main>

    <aside class="hidden lg:block sticky top-8 pt-12">
      <div class="border-l border-slate-800 pl-4">
        <h3 class="font-bold text-white mb-4 uppercase text-sm tracking-wider">Mục lục</h3>
        <ul class="space-y-3 text-sm">
          {headings.map((heading) => (
            <li class={`
              ${heading.depth === 2 ? 'font-medium text-slate-300' : ''}
              ${heading.depth === 3 ? 'pl-4 text-slate-500' : ''}
            `}>
              <a 
                href={`#${heading.slug}`} 
                class="hover:text-sky-400 transition-colors block py-1"
              >
                {heading.text}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </aside>

  </div>
</Layout>